<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>

<script>

    async function getLocalIP() {
        return new Promise((resolve, reject) => {
            const peerConnection = new RTCPeerConnection({
                iceServers: [{urls: 'stun:stun.l.google.com:19302'}] // Google 的免费 STUN 服务器
            });


            // 监听候选地址
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    const candidate = event.candidate.candidate;
                    const match = candidate.match(/(\d{1,3}(\.\d{1,3}){3})/); // 匹配 IP 地址
                    if (match) {
                        resolve(match[1]); // 返回匹配的 IP 地址
                        peerConnection.close();
                    }
                } else {
                    reject('No local IP address found');
                }
            };

            // 创建虚拟数据通道
            peerConnection.createDataChannel('test');

            // 设置 SDP（Session Description Protocol）
            peerConnection.createOffer()
                .then((offer) => peerConnection.setLocalDescription(offer))
                .catch((error) => reject(error));
        });
    }

    // 调用示例
    getLocalIP()
        .then((ip) => {
            alert(ip)
            // fetch(`http://localhost:1234/locale?ip=${ip}`, {
            //     method: "get"
            // }).then(res => {
            //     res.json().then(data => {
            //         console.log(data)
            //     })
            // })
        })
        .catch((error) => console.error('Error:', error));


</script>
</html>